function getXML(){var t="";try{var e=require("fs");t=e.readFileSync("/home/jackycoins/tmp/mers/data.xml","utf8")}catch(e){t=getXMLForWeb()}var n=$($.parseXML(t));return n}function getWorkers(){var t=[],e=getXML();$(e).find("worker").each(function(){var e=$(this).find("avatar").text(),n=$(this).find("name").text(),r=[];$(this).find("order").each(function(){var t=$(this).find("car-number").text().toUpperCase(),e=$(this).find("car-region").text(),n=$(this).find("condition").text(),i=$(this).find("start-repair").text(),o=$(this).find("finish-repair").text(),a=new Order(t,e,n,i,o);r.push(a)});var i=new Worker(e,n,r);t.push(i)});return t}function updateData(){$(".main").empty();var t=getWorkers(),e=t.length;1==e?(showWorker(t[0],1),makeOneColumn()):2==e?(showWorker(t[0],1),showWorker(t[1],2),makeTwoColumns()):3==e?(showWorker(t[0],1),showWorker(t[1],2),showWorker(t[2],3),makeThreeColumns()):showWarning()}function Order(t,e,n,r,i){this.carNumber=t,this.carRegion=e,this.condition=n,this.startRepair=r,this.finishRepair=i}function getTemplateForOrder(t){var e='<table class="worker-order">\t\t\t\t\t\t\t\t<tr class="order-details">\t\t\t\t\t\t\t\t\t<td class="car-number"><table><tr><td class="number" rowspan=2>'+t.carNumber+'</td><td class="region">'+t.carRegion+'</td></tr><tr><td class="flag"></td></tr></table></td>\t\t\t\t\t\t\t\t\t<td class="start-repair">'+t.startRepair+'</td>\t\t\t\t\t\t\t\t\t<td class="condition">'+t.condition+'</td>\t\t\t\t\t\t\t\t\t<td class="finish-repair">'+t.finishRepair+"</td>\t\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t\t</table>";return e}function showWorker(t,e){t.orders.length<=COUNT_OF_ORDERS?showWithStaticOrders(t,e):showWithDinamicOrders(t,e)}function showWarning(){var t='<div class="warning">Заказов нет</div>';$(".main").append(t)}function makeOneColumn(){$(".worker").css("margin-left","5%").css("width","90%")}function makeTwoColumns(){$(".worker:first-child").css("margin-left","5em").css("float","left"),$(".worker:last-child").css("float","right").css("margin-right","5em")}function makeThreeColumns(){$(".worker:nth-child(1)").css("display","inline-block").css("width","30%").css("margin-left","2%").css("margin-right","2%"),$(".worker:nth-child(2)").css("display","inline-block").css("width","30%"),$(".worker:nth-child(3)").css("display","inline-block").css("width","30%").css("margin-right","1%").css("margin-left","2%")}function showWithStaticOrders(t,e){for(var n=getTemplateForWorker(t,e),r=t.orders,i=0;i<4;i++)n+=getTemplateForOrder(r[i]);n+="</div>",$(".main").append(n)}function showWithDinamicOrders(t,e){function n(){function t(t,n){t<i.length?$(".worker:nth-child("+e+") .dinamic .worker-order:nth-child("+n+")").toggleClass("animated flipInX").html(getTemplateForOrder(i[t])):$(".worker:nth-child("+e+") .dinamic .worker-order:nth-child("+n+")").toggleClass("animated flipInX").html('<tr class="order-details"><td></td></tr>'),setTimeout(function(){$(".worker:nth-child("+e+") .dinamic .worker-order:nth-child("+n+")").toggleClass("animated flipInX")},1e3)}for(var n=500,r=1,o=0;o<COUNT_OF_ORDERS;o++)setTimeout(t,n,o,r),n+=500,r++;n=TIME_OF_CIRCLE/2,r=1;for(var o=COUNT_OF_ORDERS;o<2*COUNT_OF_ORDERS;o++)setTimeout(t,n,o,r),n+=500,r++;if(i.length>2*COUNT_OF_ORDERS){n=TIME_OF_CIRCLE-1e4,r=1;for(var o=2*COUNT_OF_ORDERS;o<3*COUNT_OF_ORDERS;o++)setTimeout(t,n,o,r),n+=500,r++}}var r=getTemplateForWorker(t,e),i=t.orders;r+='<div class="dinamic" style="height: 24.8em">';for(var o=0;o<COUNT_OF_ORDERS;o++)r+='<table class="worker-order">\t\t\t\t\t\t\t\t<tr class="order-details"><td>\t\t\t\t\t\t\t\t</td></tr></table>';r+="</div></div>",$(".main").append(r),n()}function showVideo(){$(".bgvideo").toggle().get(0).play()}function getTimeOfCircle(){return TIME_OF_CIRCLE}function showTime(){function t(t){return t<10?"0"+t:t}function e(t){switch(t){case 0:return"января";case 1:return"февраля";case 2:return"марта";case 3:return"апреля";case 4:return"мая";case 5:return"июня";case 6:return"июля";case 7:return"августа";case 8:return"сентября";case 9:return"октября";case 10:return"ноября";case 11:return"декабря"}}var n=new Date;$(".time p").html(n.getDate()+" "+e(n.getMonth())+" "+n.getHours()+":"+t(n.getMinutes())+":"+t(n.getSeconds()))}function Worker(t,e,n){this.avatar=t,this.name=e,this.orders=n}function getTemplateForWorker(t,e){var n='<div class="worker '+e+'"><div class="worker-personal"> \t\t\t\t\t\t\t\t<img src="app/img/'+t.avatar+'.jpg" alt="worker-avatar" \t\t\t\t\t\t\t\tclass="worker-avatar img-thumbnail"> \t\t\t\t\t\t\t\t<h2 class="worker-name">'+t.name+"</h2></div>";return n}function getXMLForWeb(){return xml='<rss version="2.0">\t\t\t\t\t\t <worker>\t\t\t\t\t\t \t<personality>\t\t\t\t\t\t \t\t<avatar>Каверин</avatar>\t\t\t\t\t\t \t\t<name>Олег</name>\t\t\t\t\t\t \t</personality>\t\t\t\t\t\t \t<orders>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>O593MX</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>18:16</start-repair>\t\t\t\t\t\t \t\t\t<condition>Приемка</condition>\t\t\t\t\t\t \t\t\t<finish-repair>23:16</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>C400EC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>-</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>19:30</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>H900XB</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>16:30</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>18:10</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>E411KX</car-number>\t\t\t\t\t\t \t\t\t<car-region>23</car-region>\t\t\t\t\t\t \t\t\t<start-repair>12:40</start-repair>\t\t\t\t\t\t \t\t\t<condition></condition>\t\t\t\t\t\t \t\t\t<finish-repair>14:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>P093PP</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>16:00</start-repair>\t\t\t\t\t\t \t\t\t<condition></condition>\t\t\t\t\t\t \t\t\t<finish-repair>17:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>R546OC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>17:00</start-repair>\t\t\t\t\t\t \t\t\t<condition>Согласование с клиентом</condition>\t\t\t\t\t\t \t\t\t<finish-repair>20:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>H900XB</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>16:30</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>18:10</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t</orders>\t\t\t\t\t\t </worker>\t\t\t\t\t\t <worker>\t\t\t\t\t\t \t<personality>\t\t\t\t\t\t \t\t<avatar>Альшанов</avatar>\t\t\t\t\t\t \t\t<name>Владимир</name>\t\t\t\t\t\t \t</personality>\t\t\t\t\t\t \t<orders>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>O593MX</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>18:16</start-repair>\t\t\t\t\t\t \t\t\t<condition>Приемка</condition>\t\t\t\t\t\t \t\t\t<finish-repair>23:16</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>O593MX</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>18:16</start-repair>\t\t\t\t\t\t \t\t\t<condition>Приемка</condition>\t\t\t\t\t\t \t\t\t<finish-repair>23:16</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>R546OC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>-</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>16:29</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>P881PP</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>10:20</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>19:40</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>H777YK</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>12:09</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>12:15</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>H214OE</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>13:00</start-repair>\t\t\t\t\t\t \t\t\t<condition></condition>\t\t\t\t\t\t \t\t\t<finish-repair>13:59</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>H900XB</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>16:30</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>18:10</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>R546OC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>17:00</start-repair>\t\t\t\t\t\t \t\t\t<condition>Согласование с клиентом</condition>\t\t\t\t\t\t \t\t\t<finish-repair>20:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>O593MX</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>18:16</start-repair>\t\t\t\t\t\t \t\t\t<condition>Приемка</condition>\t\t\t\t\t\t \t\t\t<finish-repair>23:16</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>C400EC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>-</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>19:30</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>E411KX</car-number>\t\t\t\t\t\t \t\t\t<car-region>23</car-region>\t\t\t\t\t\t \t\t\t<start-repair>12:40</start-repair>\t\t\t\t\t\t \t\t\t<condition></condition>\t\t\t\t\t\t \t\t\t<finish-repair>14:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t</orders>\t\t\t\t\t\t </worker>\t\t\t\t\t\t <worker>\t\t\t\t\t\t \t<personality>\t\t\t\t\t\t \t\t<avatar>Каверин</avatar>\t\t\t\t\t\t \t\t<name>Олег</name>\t\t\t\t\t\t \t</personality>\t\t\t\t\t\t \t<orders>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>C400EC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>-</start-repair>\t\t\t\t\t\t \t\t\t<condition>Ожидание приема</condition>\t\t\t\t\t\t \t\t\t<finish-repair>19:30</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>E411KX</car-number>\t\t\t\t\t\t \t\t\t<car-region>23</car-region>\t\t\t\t\t\t \t\t\t<start-repair>12:40</start-repair>\t\t\t\t\t\t \t\t\t<condition></condition>\t\t\t\t\t\t \t\t\t<finish-repair>14:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>P093PP</car-number>\t\t\t\t\t\t \t\t\t<car-region>93</car-region>\t\t\t\t\t\t \t\t\t<start-repair>16:00</start-repair>\t\t\t\t\t\t \t\t\t<condition></condition>\t\t\t\t\t\t \t\t\t<finish-repair>17:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>R546OC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>17:00</start-repair>\t\t\t\t\t\t \t\t\t<condition>Согласование с клиентом</condition>\t\t\t\t\t\t \t\t\t<finish-repair>20:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>R546OC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>17:00</start-repair>\t\t\t\t\t\t \t\t\t<condition>Согласование с клиентом</condition>\t\t\t\t\t\t \t\t\t<finish-repair>20:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t\t<order>\t\t\t\t\t\t \t\t\t<car-number>R546OC</car-number>\t\t\t\t\t\t \t\t\t<car-region>123</car-region>\t\t\t\t\t\t \t\t\t<start-repair>17:00</start-repair>\t\t\t\t\t\t \t\t\t<condition>Согласование с клиентом</condition>\t\t\t\t\t\t \t\t\t<finish-repair>20:00</finish-repair>\t\t\t\t\t\t \t\t</order>\t\t\t\t\t\t \t</orders>\t\t\t\t\t\t </worker>\t\t\t\t\t\t </rss>',xml}$(document).ready(function(){setInterval(showTime,1e3),updateData(),setInterval(function(){updateData()},getTimeOfCircle())});var COUNT_OF_ORDERS=5,TIME_OF_CIRCLE=4e4;